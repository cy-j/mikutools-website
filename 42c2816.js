(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{1177:function(t,e,n){"use strict";n(19);e.a={upload:function(t,e,n){var o=n.format,r=n.cnapi,l=n.metaData;return new Promise((function(n,c){var d=new FormData;d.append("image",e),t.$axios.post("/upload_image",d,{cnapi:r,params:{format:o||"webp"}}).then((function(t){var e=r?"https://dogcloud-mikutools-cnapi.cdn.hatsune.tech":"https://dogcloud-mikutools-api.cdn.hatsune.tech",o=new URL(t.data.data,e),image=new Image;image.src=o,image.onload=function(){n(l?{url:o,e:t}:o)}})).catch(c)}))}}},1316:function(t,e,n){var content=n(2534);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(12).default)("ec698742",content,!0,{sourceMap:!1})},2533:function(t,e,n){"use strict";var o=n(1316);n.n(o).a},2534:function(t,e,n){(e=n(11)(!1)).push([t.i,".search_pic .nya-subtitle{margin-top:.9375rem}.search_pic .preview{max-height:12.5rem}.search_pic .imginfo{display:inline-block;width:calc(20% - .625rem);vertical-align:top;margin:.3125rem}@media (max-width:1050px){.search_pic .imginfo{width:calc(25% - .625rem)}}@media (max-width:800px){.search_pic .imginfo{width:calc(33.33333% - .625rem)}}@media (max-width:550px){.search_pic .imginfo{width:calc(50% - .625rem)}}.search_pic .imginfo img{width:100%;height:9.375rem;-o-object-fit:cover;object-fit:cover}.search_pic .imginfo div{padding:.625rem}.search_pic .imginfo div p{margin-top:0;margin-bottom:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}",""]),t.exports=e},2878:function(t,e,n){"use strict";n.r(e);var o=n(1177),r={name:"SearchPic",head:function(){return this.$store.state.currentTool.head},data:function(){return{n:"",file:null,data:[],uploadData:null,loading:!1,loadingText:"上传中···"}},methods:{handleChange:function(t){var e=t.target.files;if(!e.length)return!1;var n=e[0];n.size/1024/1024>5?(this.n="",this.$notify.error({title:"识别失败",message:"请选择大小在5M以内的图片"})):(this.data=[],this.uploadData=null,this.file=n)},start:function(){return!!this.file&&(!this.loading&&(this.data=[],this.loading=!0,void(this.uploadData?this.searchPic(this.uploadData.e.data.data):(this.uploadData=null,this.uploadImg()))))},uploadImg:function(){var t=this;this.loadingText="上传中···",o.a.upload(this,this.file,{metaData:!0,format:"jpeg"}).then((function(e){t.uploadData=e,t.searchPic(e.e.data.data)})).catch((function(e){t.$notify.error({title:"上传图片失败",message:e}),t.loading=!1}))},searchPic:function(t){var e=this;this.loadingText="搜索中···",this.$axios.post("/search_pic",{url:t}).then((function(t){e.loading=!1,t.data.data.length?e.data=t.data.data:e.$notify.error({title:"识别失败",message:"没有找到相似的图片"})})).catch((function(t){e.$notify.error({title:"识别失败",message:t}),e.loading=!1}))}}},l=(n(2533),n(7)),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"search_pic"},[n("nya-container",{attrs:{title:"以图搜图"}},[n("div",{staticClass:"nya-subtitle mt-0"},[t._v("\n            请选择要识别 ACG 图片\n        ")]),n("el-input",{attrs:{type:"file",accept:"image/*",disabled:t.loading,placeholder:t.n?t.n.replace(/C:\\fakepath\\/,""):"点击这里上传文件"},nativeOn:{change:function(e){return t.handleChange(e)}},model:{value:t.n,callback:function(e){t.n=e},expression:"n"}},[n("el-button",{attrs:{slot:"append",loading:t.loading},on:{click:t.start},slot:"append"},[t._v("\n                "+t._s(t.loading?t.loadingText:"开始获取")+"\n            ")])],1),t.uploadData?n("div",{staticClass:"nya-subtitle"},[t._v("\n            预览\n        ")]):t._e(),t.uploadData?n("img",{staticClass:"preview",attrs:{src:t.uploadData.url,alt:"preview"}}):t._e()],1),t.data.length?n("nya-container",{attrs:{title:"获取成功"}},[t._l(t.data,(function(e,o){return[n("div",{key:o,staticClass:"imginfo"},[n("img",{attrs:{src:e.img}}),t._v("\n                链接："),n("a",{attrs:{href:e.link,target:"_blank",rel:"noopener noreferrer"}},[t._v("\n                    "+t._s(e.link)+"\n                ")])])]}))],2):t._e(),n("nya-container",{attrs:{title:"说明"}},[n("ul",{staticClass:"nya-list"},[n("li",[n("b",[t._v("暂时只支持 ACG 图片搜索")])]),n("li",[n("b",[t._v("请善于使用 "),n("nuxt-link",{attrs:{to:"/picture_clipping"}},[t._v("图片裁剪")]),t._v(" 更高效率的识别图片")],1)]),n("li",[t._v("识别成功率取决于上传的图片")]),n("li",[t._v("多个相同/类似结果是因为返回的数据包含多个相同/类似结果，推荐使用 Pixiv 的数据")])])])],1)}),[],!1,null,null,null);e.default=component.exports}}]);